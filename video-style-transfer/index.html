
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161322277-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161322277-1');
</script>

<link rel="shortcut icon" type="image/x-icon" href="teasers/favicon.ico" />
<title>Stabilizing neural style-transfer for videos with PyTorch</title>
<meta name = "description=" content="Thomas Dougherty Blog and posts on machine learning, deep learning, and computer vision topics">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=IBM Plex Sans' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Spectral' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

<link href="css/style.css" rel="stylesheet" type="text/css" />
<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script type="text/javascript"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>




<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">

</head>


<body>


  <div class="header_img">
    <img style='height: 100%; width: 100%; object-fit: contain' src="resources/header.png"/>
  </div>
  
<div class="topcorner">
  <div id="container">
    <div class="toggle">
      <input type="checkbox" name="toggle" class="check-checkbox" id="mytoggle">
      <label class="check-label" for="mytoggle">
        <div id="background"></div>
        <span class="face">
          <span class="face-container">
            <span class="eye left"></span>
            <span class="eye right"></span>
            <span class="mouth"></span>
          </span>
        </span>
      </label>
    </div>
  </div>
</div>

<script>
$(function(){
  $("#mytoggle").change(function() {
    $("body").toggleClass("dark-mode", this.checked)
  }).change();
})
</script>


<script>
  function emailClipboard() {
    var copyText = document.getElementById("myInput");
    copyText.select();
    copyText.setSelectionRange(0, 99999)
    document.execCommand("copy");
    alert("Copied: " + copyText.value);
  }
  </script>
<input type = "text" value="tdougherty84@gmail.com" id="myInput" style="position: relative; left: -10000px;">

<div class="post_header">
    <h1>Stabilizing neural style-transfer for videos with PyTorch</h1>
    <h3>March 19th, 2020
   </h3>

    <div class="post_left">
      <div class="post_photo">
        <a href="https://thomasdougherty.github.io/">
          <img src="resources/me_sd.jpg"/>
        </a>
        <a href="https://thomasdougherty.github.io/">
           Thomas Dougherty
        </a>
      </div>
    </div>

    <div class="post_right">
        <div class="post_icon">
            <img src="icons/email.png" onclick="emailClipboard(this)"/>        
          <a href="https://github.com/thomasdougherty/" rel="noopener noreferrer" target="_blank">
            <img src="icons/git.png"/>
          </a>
          <a href="https://www.linkedin.com/in/thomasjosephdougherty/" rel="noopener noreferrer" target="_blank">
            <img src="icons/linkedin.png"/>
          </a>
          <a href="https://twitter.com/tommyjdeee" rel="noopener noreferrer" target="_blank">
            <img src="icons/twitter.png"/>
          </a>
        </div>
      </div>
</div>



<div class="post_line"></div>

<div class="content">
  <a>This project is a PyTorch implementation of Element AI's </a>
    <a href="https://medium.com/element-ai-research-lab/stabilizing-neural-style-transfer-for-video-62675e203e42" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">
      Stabilizing neural style-transfer for video</a> 
   <a>
     . This post dives into the details of neural style transfer for images, the challenges
     with video style transfer, and Element AI's approach towards video style transfer. Please skip to whatever 
     is most relevant to you. All code can be found
   </a>
   <a href="https://github.com/ThomasDougherty/video_style_transfer" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">here</a> 
 <a>.</a>
  
</div>


<div class="content">
  <h2>Style Transfer</h2>
  <a>Let's first define what we are striving for with a style transfer.</a>
  <div class="content_bold">
    <a>We want a style transfer to modify the style of an image while still
      preserving its content.</a>
  </div>
  <a>Given an input image and a style image, we want an output image with the
    original content but a new style. This is outlined in 
  </a>
  <a href="https://arxiv.org/abs/1508.06576" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">A Neural Algorithm of Artistic Style</a> 
  <a>. Below are some examples of stylization.</a>

  <img style='height: 90%; width: 90%; object-fit: contain' src="resources/picasso.gif"/>
  <div class="content_img_desc">
    <a>Pablo Picasso</a> 
    <a href="https://www.youtube.com/watch?v=CkRS3wDg1xU" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">painting on glass in 1937</a> 
    <a>: stolen </a> 
    <a href="https://medium.com/data-science-group-iitr/artistic-style-transfer-with-convolutional-neural-network-7ce2476039fd" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">here</a> 
  </div>
  
  <img style='height: 100%; width: 100%; object-fit: contain' src="resources/corgi5.png"/>
  <div class="content_img_desc">
    <a>Corgi (content) + style</a> 
  </div>

  <a>
    <br>
    There are two main components to a style transfer:<br>
    (i) Image Transformation Network<br>
    (ii) Loss Network<br>
  </a>

  <img style='height: 100%; width: 100%; object-fit: contain' src="resources/model.png"/>
  <div class="content_img_desc">
    <a>Style transfer architecture: Image transformation network followed by the Loss Network (VGG-16)</a> 
  </div>

  <div class="content_bold">
    <a>Image Transformation Network</a>
  </div>

  <a>
    The image transformation network is the model that is trained. It takes in
    your content image and returns your stylized output. To clarify, the input image
    and the content image are the same for style transfer. Feeding a color image
    of shape 3 x 256 x 256, the image transformation network returns
    a stylized image of the same shape 3 x 256 x 256. 
    <br>
    <br>
    There are many variations of the image transformation network. A commonly used
    one is an
    <a href="https://en.wikipedia.org/wiki/Autoencoder" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">
      autoencoder</a> 
    <a>
    . An autoencoder first learns to represent the data in a smaller dimensional space
    (encoder), then learns to reconstruct the data (decoder) to its original size.
    The aim of an autoencoder is to learn useful properties of the data. A good way
    to think about it is the autoencoder filters out "noise" from the data and 
    "enhances" useful properties, where you define what is "noise" and "useful", i.e. 
    background vs foreground.
    To check out a popular type of autoencoder, see  </a>
    <a href="https://towardsdatascience.com/u-net-b229b32b4a71" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">
      UNet architecture</a> 
    <a>.</a> 
    <div class="content_bold">
      <a>Loss Network</a>
    </div>
    <a>
      We want the style of our input image to be modified, but still
      preserve its original content.
      The loss network we'll be using is a 16-layer VGG network pretrained
      on the ImageNet dataset. From our knowledge of Convolutional Neural Networks,
      higher layers capture image content and overall spatial structure, where lower 
      layers capture lower level features such as colors, textures, common patterns, etc. 
      A nice visualization of convolutional features can be found </a>
      <a href="https://towardsdatascience.com/how-to-visualize-convolutional-features-in-40-lines-of-code-70b7d87b0030" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">
        here</a> 
     <a>. Because of this, our loss network will be using the top layers of the
      VGG-16 model, specifically up to layer </a>
       <a style="font-style: italic"> 'relu4_3'</a>
       <a>.</a>
      <a>     
        <br>
        <br>
      We'll be using the loss network to calculate two losses: <br>
      1. Content Loss
      <br>
      2. Style Loss
    </a>

    <a>    
      <br>
      <br>
      The formulas for our loss functions come from Johnson's </a>
    <a href="https://arxiv.org/abs/1603.08155" rel="noopener noreferrer" target="_blank" style="text-decoration:underline;">
      Perceptual Losses for Real-Time Style Transfer and Super-Resolution</a> 
    <a>. Where we refer to their Feature Reconstruction Loss as Content Loss, 
      and Style Reconstruction Loss as Style Loss.
    </a> 
    <div class="content_bold">
      <a>Content Loss</a>
    </div>
    <a>
      We want the output of our image transformation network to have similar 
      features to our content image, but not necessarily a pixel to pixel match.
      This is controlled by the content loss. We know that \(ax^2 + bx + c = 0\).
      

      $$L_{content} = \frac{1}{C_j H_j W_j}\| \phi_j\left( \hat{y} \right) - \phi_j\left(y \right) \|^2_2$$
    </a>
  </a>
  
</div>






<div class="code">
  <script src="https://gist.github.com/ThomasDougherty/6ba3f0fd4633070d428c8f9e2d1d2d66.js"></script>
</div>

<div class="sidenav" >
  <div class="instructorphoto">
    <a href="https://thomasdougherty.github.io/">
    <img src="resources/me_sd.jpg"/>
  </a>
  </div>
    <a href="https://thomasdougherty.github.io/">
    Thomas Dougherty
  </a>
  <div class="profile_links">
    <a>
      <img src="icons/email.png" onclick="emailClipboard(this)"/> 
    </a>
    <a href="https://github.com/thomasdougherty/" rel="noopener noreferrer" target="_blank">
      <img src="icons/git.png"/>
    </a>
    <a href="https://www.linkedin.com/in/thomasjosephdougherty/" rel="noopener noreferrer" target="_blank">
      <img src="icons/linkedin.png"/>
    </a>
    <a href="https://twitter.com/tommyjdeee" rel="noopener noreferrer" target="_blank">
      <img src="icons/twitter.png"/>
    </a>
  </div>
</div>

<script>
  $(window).bind('scroll', 'resize', function myFunction() {
    var winWidth = $(window).width();
    if ($(window).scrollTop() > 950 && winWidth >= 1250) {
        $('.sidenav').show();
    }
    else {
        $('.sidenav').hide();
    }
  });

  $(window).on("resize", myFunction);
  $(window).on("scroll", myFunction);
  window.addEventListener('resize', myFunction);
  </script>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

          
</body>
</html>
